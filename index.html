<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IHA Code Generator</title>
    <style>
        /* Add your CSS styles here */
        .subb,
        .subb2 {
            margin-left: 14em; /* Adjust the value as needed */
            display: none; /* Hide the divs by default */
        }

        header h1 {
            margin-left: 2em; /* Adjust the value as needed */
            color: blue; /* Set the color to blue */
        }

        #downloadButton {
            margin-left: 2em; /* Adjust the value as needed */
            background-color: green; /* Set the background color to green */
            color: white; /* Set the text color to white */
            border: none; /* Remove border for a cleaner look */
            padding: 10px 20px; /* Add padding for better appearance */
            cursor: pointer; /* Add cursor pointer for user interaction */
        }
    </style>

</head>

<body>
    <header>
        <h1>IHA Rack System V8</h1>
    </header>

    <main>
        <label for="dropdown1">Node Device 1 Address:</label>
        <select id="dropdown1">
            <option value="none">None</option>
            <option value="0x20">0x20</option>
            <option value="0x21">0x21</option>
            <option value="0x22">0x22</option>
            <option value="0x23">0x23</option>
            <option value="0x24">0x24</option>
            <option value="0x25">0x25</option>
            <option value="0x26">0x26</option>
            <option value="0x27">0x27</option>
            <!-- Add more options for Node Device 1 as needed -->
        </select>
    </main>
    <div class="subb">
        <label for="type1">Node Device 1 Type:</label>
        <select id="type1">
            <option value="none">none</option>
            <option value="16 GPIO Rack Card 1">16 GPIO Rack Card 1</option>
            <option value="16 GPIO Rack Card 2">16 GPIO Rack Card 2</option>
            <option value="16 GPIO Rack Card 3">16 GPIO Rack Card 3</option>
            <option value="16 GPIO Rack Card 4">16 GPIO Rack Card 4</option>
            <option value="Button Controller">Button Controller</option>
            <option value="8 Port Relay Board 1">8 Port Relay Board 1</option>
            <option value="8 Port Relay Board 2">8 Port Relay Board 2</option>
            <option value="8 Port Relay Board 3">8 Port Relay Board 3</option>
            <option value="8 Port Relay Board 4">8 Port Relay Board 4</option>
            <!-- Add more options for Node Device Type 1 as needed -->
        </select>
    </div>
    <main>
        <label for="dropdown2">Node Device 2 Address:</label>
        <select id="dropdown2">
            <option value="none">None</option>
            <option value="0x20">0x20</option>
            <option value="0x21">0x21</option>
            <option value="0x22">0x22</option>
            <option value="0x23">0x23</option>
            <option value="0x24">0x24</option>
            <option value="0x25">0x25</option>
            <option value="0x26">0x26</option>
            <option value="0x27">0x27</option>
            <!-- Add more options for Node Device 2 as needed -->
        </select>
    </main>
    <div class="subb2">
        <label for="type2">Node Device 2 Type:</label>
        <select id="type2">
            <option value="none">none</option>
            <option value="16 GPIO Rack Card 1">16 GPIO Rack Card 1</option>
            <option value="16 GPIO Rack Card 2">16 GPIO Rack Card 2</option>
            <option value="16 GPIO Rack Card 3">16 GPIO Rack Card 3</option>
            <option value="16 GPIO Rack Card 4">16 GPIO Rack Card 4</option>
            <option value="Button Controller">Button Controller</option>
            <option value="8 Port Relay Board 1">8 Port Relay Board 1</option>
            <option value="8 Port Relay Board 2">8 Port Relay Board 2</option>
            <option value="8 Port Relay Board 3">8 Port Relay Board 3</option>
            <option value="8 Port Relay Board 4">8 Port Relay Board 4</option>
            <!-- Add more options for Node Device Type 2 as needed -->
        </select>
    </div>
    <!-- Add 6 text entry boxes -->
    <div>
        <label for="textEntry1">ESPHome Name:</label>
        <input type="text" id="textEntry1">
    </div>
    <div>
        <label for="textEntry2">OTA Password:</label>
        <input type="text" id="textEntry2">
    </div>
    <div>
        <label for="textEntry3">Web Portal Username:</label>
        <input type="text" id="textEntry3">
    </div>
    <div>
        <label for="textEntry4">Web Portal Password:</label>
        <input type="text" id="textEntry4">
    </div>
    <div>
        <label for="textEntry5">Display Name:</label>
        <input type="text" id="textEntry5">
    </div>
    <div>
        <label for="textEntry6">API Key:</label>
        <input type="text" id="textEntry6">
    </div>
    <button id="downloadButton">Download YAML File</button>

    <!-- Add your JavaScript code here if needed -->
    <script>
        const dropdown1 = document.getElementById('dropdown1');
        const dropdown2 = document.getElementById('dropdown2');
        const typeDropdown1 = document.getElementById('type1');
        const typeDropdown2 = document.getElementById('type2');
        const subbDiv1 = document.querySelector('.subb');
        const subbDiv2 = document.querySelector('.subb2');
        const downloadButton = document.getElementById('downloadButton');

        function updateSubbVisibility() {
            // Show/hide the subbDiv1 based on the selected value of dropdown1
            subbDiv1.style.display = dropdown1.value === 'none' ? 'none' : 'block';

            // Show/hide the subbDiv2 based on the selected value of dropdown2
            subbDiv2.style.display = dropdown2.value === 'none' ? 'none' : 'block';

            // If dropdown1 is set to none and dropdown2 is not set to none, hide subbDiv1
            if (dropdown1.value === 'none' && dropdown2.value !== 'none') {
                subbDiv1.style.display = 'none';
            }
        }

        dropdown1.addEventListener('change', updateSubbVisibility);
        dropdown2.addEventListener('change', updateSubbVisibility);

        downloadButton.addEventListener('click', function () {
            // Get the selected values
            const selectedOptionValue1 = dropdown1.value;
            const selectedOptionValue2 = dropdown2.value;
            const selectedTypeValue1 = typeDropdown1.value;
            const selectedTypeValue2 = typeDropdown2.value;

            // Get text entry values
            const textEntry1 = document.getElementById('textEntry1').value;
            const textEntry2 = document.getElementById('textEntry2').value;
            const textEntry3 = document.getElementById('textEntry3').value;
            const textEntry4 = document.getElementById('textEntry4').value;
            const textEntry5 = document.getElementById('textEntry5').value;
            const textEntry6 = document.getElementById('textEntry6').value;

            // Create the YAML configuration string based on the selected type
            let yamlConfig = '';
            let additionalConfig = '';
            additionalConfig += `
substitutions:            `;   
            // Add text entry values to the YAML
            if (selectedTypeValue1 === '16 GPIO Rack Card 1') {
                additionalConfig += `
  gpio_rack_card_1_device_1: "GPIO 1"
  gpio_rack_card_1_device_2: "GPIO 2"
  gpio_rack_card_1_device_3: "GPIO 3"
  gpio_rack_card_1_device_4: "GPIO 4"
  gpio_rack_card_1_device_5: "GPIO 5"
  gpio_rack_card_1_device_6: "GPIO 6"
  gpio_rack_card_1_device_7: "GPIO 7"
  gpio_rack_card_1_device_8: "GPIO 8"
  gpio_rack_card_1_device_9: "GPIO 9"
  gpio_rack_card_1_device_10: "GPIO 10"
  gpio_rack_card_1_device_11: "GPIO 11"
  gpio_rack_card_1_device_12: "GPIO 12"
  gpio_rack_card_1_device_13: "GPIO 13"
  gpio_rack_card_1_device_14: "GPIO 14"
  gpio_rack_card_1_device_15: "GPIO 15"
  gpio_rack_card_1_device_16: "GPIO 16"  `;            
            additionalConfig += `
esphome:
  name: ${textEntry1}
  on_boot:
       - delay: 1s
       - text_sensor.template.publish:
          id: last_name_pressed
          state: ""    
       - text_sensor.template.publish:
          id: last_state_pressed
          state: ""  
esp32:
  board: esp-wrover-kit
  framework: 
    type: esp-idf
       
       
web_server:
  port: 80
  auth:
    username: ${textEntry3}
    password: ${textEntry4}
                                 
ota:  
  password: ${textEntry2} 
ethernet:
  id: eth
  type: LAN8720
  mdc_pin: GPIO23
  mdio_pin: GPIO18
  clk_mode: GPIO0_IN
  phy_addr: 1
  power_pin: GPIO16
api:
  encryption:
    key: "${textEntry6}"
  reboot_timeout: 0s  

i2c:
  sda: 14
  scl: 15
  scan: true 

display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x64"
    address: 0x3C
    lambda: |-
            if (id(system_status).state) {
              it.print(40, -3, id(my_font_30b), id(my_green), "Online");
            }
            else {
              it.print(40, -5, id(my_font_30b), id(my_yellow), "Offline");
            }
            it.printf(it.get_width() / 2, 14, id(my_font_20b), id(my_blue), TextAlign::CENTER_HORIZONTAL," %s",id(last_name_pressed).state.c_str()); 
            it.printf(it.get_width() / 2, 24, id(my_font_20b), id(my_blue), TextAlign::CENTER_HORIZONTAL," %s",id(last_state_pressed).state.c_str());             
            it.print(0, 34, id(my_font_20b), id(my_white), "IP");                                              
            it.printf(it.get_width() / 2, 46, id(my_font_13b), id(my_green), TextAlign::CENTER_HORIZONTAL, " %s",id(uptime_human).state.c_str());   
   #         it.printf(it.get_width() / 2,34, id(my_font_20b), id(my_white), TextAlign::CENTER_HORIZONTAL, " %s",id(ipaddress).state.c_str());      
text_sensor:
  - platform: template
    id: last_state_pressed    
    name: $display_name State
    icon: "mdi:state-machine"
  - platform: template
    id: last_name_pressed        
    name: $display_name Device    
    icon: "mdi:state-machine" 
  - platform: template
    id: uptime_human 
    name: Update    
    icon: mdi:clock-start
  - platform: template
    name: "Device IP"
    id: ipaddress
    entity_category: diagnostic
    icon: "mdi:ip-network"
    lambda: return { id(eth).get_ip_address().str() };
    update_interval: 5s  

sensor:
  - platform: uptime
    id: uptime_sensor
    update_interval: 1s
    on_raw_value:
      then:
        - text_sensor.template.publish:
            id: uptime_human
            state: !lambda |-
              int seconds = round(id(uptime_sensor).raw_state);
              int days = seconds / (24 * 3600);
              seconds = seconds % (24 * 3600);
              int hours = seconds / 3600;
              seconds = seconds % 3600;
              int minutes = seconds /  60;
              seconds = seconds % 60;
              return (
                (days ? to_string(days) + "d " : "") +
                (hours ? to_string(hours) + "h " : "") +
                (minutes ? to_string(minutes) + "m " : "") +
                (to_string(seconds) + "s")
              ).c_str();

light:
  - platform: esp32_rmt_led_strip
    id: statusledlight
    name: "Status LED RGB"
    pin: 33
    num_leds: 1
    rmt_channel: 1
    rgb_order: GRB
    chipset: ws2812
    icon: "mdi:led-outline"
    max_refresh_rate: 500ms
    


switch:
  - platform: restart
    id: "restart_system"
  - platform: gpio
    pin: GPIO32
    name: Pico Buzzer
    inverted: no  
    id: buzzer
    icon: "mdi:surround-sound"
  - platform: gpio
    pin: GPIO04
    name: On Board Relay
    icon: "mdi:electric-switch"
    inverted: no  
    id: relay

binary_sensor:
  - platform: status
    id: system_status
    name: status
    on_press:
          then:
            - light.turn_on: 
                id: statusledlight
                green: 1.0
                red: 0.0
                blue: 0.0
                brightness: 30%      
    on_release:
          then:           
            - light.turn_on: 
                id: statusledlight
                red: 1.0
                green: 0.0
                blue: 0.0
                brightness: 30%     
color:
  - id: my_red
    red: 100%
    green: 0%
    blue: 0%
  - id: my_yellow
    red: 100%
    green: 100%
    blue: 0%
  - id: my_green
    red: 0%
    green: 100%
    blue: 0%
  - id: my_blue
    red: 0%
    green: 0%
    blue: 100%
  - id: my_gray
    red: 50%
    green: 50%
    blue: 50%   
  - id: my_white
    red: 100%
    green: 100%
    blue: 100%              

font:
  - file: "_fonts/refsan.ttf"
    id: my_font_30
    size: 30
  - file: "_fonts/refsan.ttf"
    id: my_font_20
    size: 20
  - file: "_fonts/refsan.ttf"
    id: my_font_13
    size: 13
  - file: "_fonts/refsan.ttf"
    id: my_font_15
    size: 15    
  - file: "_fonts/refsan.ttf"
    id: my_font_10
    size: 10   
  - file: "_fonts/refsan.ttf"
    id: my_font_30b
    size: 15
  - file: "_fonts/refsan.ttf"
    id: my_font_20b
    size: 10
  - file: "_fonts/refsan.ttf"
    id: my_font_13b
    size: 10  
  - file: "_fonts/refsan.ttf"
    id: my_font_15b
    size: 15    
  - file: "_fonts/refsan.ttf"
    id: my_font_10b
    size: 15 
          
          `;

            if (selectedTypeValue1 === '16 GPIO Rack Card 1') {
                additionalConfig += `
16 GPIO Rack Card 1:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '16 GPIO Rack Card 2') {
                additionalConfig += `
16 GPIO Rack Card 2:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '16 GPIO Rack Card 3') {
                additionalConfig += `
16 GPIO Rack Card 3:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '16 GPIO Rack Card 4') {
                additionalConfig += `
16 GPIO Rack Card 4:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === 'Button Controller') {
                additionalConfig += `
Button Controller:
  show text group
  ${selectedOptionValue1}`;
            }       
            if (selectedTypeValue1 === '8 Port Relay Board 1') {
                additionalConfig += `                 
8 Port Relay Board 1:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '8 Port Relay Board 2') {
                additionalConfig += `
8 Port Relay Board 2:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '8 Port Relay Board 3') {
                additionalConfig += `
8 Port Relay Board 3:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue1 === '8 Port Relay Board 4') {
                additionalConfig += `
8 Port Relay Board 4:
  show text group
  ${selectedOptionValue1}`;
            }

            //asdfasdfasdfasadf/sdf
            if (selectedTypeValue2 === '16 GPIO Rack Card 1') {
                additionalConfig += `
16 GPIO Rack Card 1B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === '16 GPIO Rack Card 2') {
                additionalConfig += `
16 GPIO Rack Card 2B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === '16 GPIO Rack Card 3') {
                additionalConfig += `
16 GPIO Rack Card 3B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === '16 GPIO Rack Card 4') {
                additionalConfig += `
16 GPIO Rack Card 4B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === 'Button Controller') {
                additionalConfig += `
Button Controller B:
  show text group
  ${selectedOptionValue2}`;
            }       
            if (selectedTypeValue2 === '8 Port Relay Board 1') {
                additionalConfig += `                 
8 Port Relay Board 1B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === '8 Port Relay Board 2') {
                additionalConfig += `
8 Port Relay Board 2B:
  show text group
  ${selectedOptionValue2}`;
            }
            if (selectedTypeValue2 === '8 Port Relay Board 3') {
                additionalConfig += `
8 Port Relay Board 3B:
  show text group
  ${selectedOptionValue1}`;
            }
            if (selectedTypeValue2 === '8 Port Relay Board 4') {
                additionalConfig += `
8 Port Relay Board 4B:
  show text group
  ${selectedOptionValue1}`;
            }            
            // Combine the two configurations
            const combinedConfig = `${yamlConfig}\n${additionalConfig}`;

            // Create a Blob and download link
            const blob = new Blob([combinedConfig], { type: 'text/plain' });
            const downloadLink = document.createElement('a');

            // Set attributes for the download link
            downloadLink.href = URL.createObjectURL(blob);
            downloadLink.download = 'rack_system_config.yaml';

            // Append the link to the body and simulate a click to trigger the download
            document.body.appendChild(downloadLink);
            downloadLink.click();

            // Remove the link from the body
            document.body.removeChild(downloadLink);
        });

        // Initial call to set the initial visibility based on the default values
        updateSubbVisibility();
    </script>
</body>

</html>